# 📂 discipline – إدارة الإجراءات التأديبية والمكافآت

نظام متخصص لتوثيق ومراقبة جميع الإجراءات التأديبية أو التحفيزية للموظفين (مثل الخصومات، الإنذارات، المكافآت) مع دعم ذكي للتقارير والتنبيهات والتحليلات.

---

## 🎯 الهدف
- تسجيل جميع العقوبات أو المكافآت لكل موظف.
- إنشاء تقارير تفصيلية حسب التواريخ أو أنواع الإجراءات.
- إصدار تنبيهات ذكية تلقائية (باستخدام الذكاء الاصطناعي).
- دعم التصدير إلى PDF وExcel.
- ربط مباشر مع تقييم الأداء ونظام الرقابة.

---

## 📦 الموديلات الأساسية

### `DisciplineRecord`
| الحقل | الوصف |
|------|-------|
| employee | الموظف المعني |
| type | نوع الإجراء (خصم/مكافأة/إنذار) |
| value_type | نوع القيمة (نسبة / مبلغ) |
| value | المبلغ أو النسبة (إن وجدت) |
| reason | السبب |
| created_by | المسؤول |
| date | تاريخ الإجراء |
| related_month | الشهر المرتبط تلقائيًا |
| notes | ملاحظات إضافية |
| is_approved | هل الإجراء معتمد؟ |

---

## 🧠 الذكاء الاصطناعي & التنبيهات

### ai.py
- تنبيه إذا تم تسجيل خصم كبير (أكثر من 200 جنيه).
- تنبيه إذا حصل الموظف على 3+ عقوبات خلال نفس الشهر.
- تسجيل مخالفة تلقائيًا في نظام المخاطر.

### signals.py
- عند تسجيل إجراء تأديبي (DisciplinaryAction - legacy): يتم تسجيل تنبيه ومخالفة تنظيمية.

---

## 🔄 المهام الخلفية (Celery)

### tasks.py
- مهمة دورية: تحليل الموظفين الذين حصلوا على أكثر من 3 عقوبات خلال الشهر.
- إرسال تنبيه وتسجيل مخاطرة تلقائيًا.

---

## 📤 التصدير والتقارير

- `discipline_report`: تقارير الانضباط بتصفية التاريخ والاسم والنوع.
- `employee_discipline_history`: تقرير فردي للموظف.
- دعم تصدير Excel وPDF.
- لوحة مخصصة للمدير: `manager_discipline_report`.

---

## 🔐 الصلاحيات

### permissions.py
- صلاحيات افتراضية تعتمد على `IsHR` أو `IsManager` (سيتم تعديلها حسب نظام المستخدم).
- يتم التحقق من صلاحية عرض أو إضافة أو تعديل إجراءات الانضباط.

---

## 🔌 التكاملات

- `employees`: ربط مباشر مع معلومات الموظف.
- `ai_decision`: تنبيهات ذكية بناءً على الحالات المسجلة.
- `internal_monitoring`: توثيق المخالفات والتحذيرات.
- `evaluations`: عرض سجل تقييمات الموظف بجانب سجل الانضباط.
- تكامل كامل مع ملفات `employee_profile.html`.

---

## 🧾 القوالب (Templates)

| الملف | الوظيفة |
|-------|----------|
| `discipline_form.html` | نموذج إضافة إجراء انضباطي |
| `discipline_log.html` | سجل الإجراءات العامة |
| `discipline_report.html` | تقرير عام شامل |
| `manager_discipline_report.html` | تقرير خاص بالمدير |
| `employee_discipline_history.html` | سجل فردي للموظف |
| `employee_discipline_pdf.html` | PDF خاص بالموظف |
| `pdf_template.html` | تنسيق PDF عام |

---

## 📁 الملفات الأساسية

| الملف | محتواه |
|-------|--------|
| `models.py` | نموذج DisciplineRecord |
| `forms.py` | نموذج إضافة السجلات |
| `admin.py` | تخصيص لوحة الإدارة |
| `urls.py` | المسارات |
| `views.py` | العرض الرئيسي |
| `report_views.py` | تقارير PDF وExcel |
| `ai.py` | منطق الذكاء الاصطناعي |
| `signals.py` | التنبيهات الفورية |
| `tasks.py` | المهام الخلفية |
| `permissions.py` | التحكم في الوصول |
| `serializers.py` | دعم API (قابل للإضافة لاحقًا) |

---

## ✅ الحالة
تم تنفيذ التطبيق بالكامل بجميع المميزات الأساسية والذكية. لا حاجة لتعديلات مستقبلية إلا بطلب المستخدم.
