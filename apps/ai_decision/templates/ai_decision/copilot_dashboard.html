<!-- templates/ai_decision/copilot_dashboard.html - Ù„ÙˆØ­Ø© Ø§Ù„Ù‚ÙŠØ§Ø¯Ø© Ø§Ù„Ø°ÙƒÙŠØ© Copilot 2025 -->
{% load static %}
<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <title>Ù„ÙˆØ­Ø© ØªØ­ÙƒÙ… Copilot</title>
  <link id="theme-style" rel="stylesheet" href="{% static 'css/copilot.css' %}">
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://unpkg.com/htmx.org@1.9.2"></script>
  <script src="{% static 'js/copilot_chat.js' %}" defer></script>
  <script src="{% static 'js/copilot_voice.js' %}" defer></script>
</head>
<body>
  <div class="copilot-container">
    <div style="display: flex; justify-content: space-between; align-items: center;">
      <h2>ğŸ“Š Ù„ÙˆØ­Ø© ØªØ­ÙƒÙ… Ø§Ù„Ù…Ø³Ø§Ø¹Ø¯ Ø§Ù„Ø°ÙƒÙŠ</h2>
      <button onclick="toggleTheme()" style="padding: 8px 16px; border-radius: 8px; background-color: #222; color: #fff; border: none; cursor: pointer;">
        ğŸŒ™/â˜€ï¸ ØªØ¨Ø¯ÙŠÙ„ Ø§Ù„ÙˆØ¶Ø¹
      </button>
    </div>

    <!-- Ø¨Ø·Ø§Ù‚Ø§Øª Ø³Ø±ÙŠØ¹Ø© -->
    <div class="kpi-cards">
      <div class="kpi-card">
        <h3>Ù…Ø¨ÙŠØ¹Ø§Øª Ø§Ù„ÙŠÙˆÙ…</h3>
        <p>{{ daily_sales|default:"--" }} Ø¬Ù†ÙŠÙ‡</p>
      </div>
      <div class="kpi-card">
        <h3>Ø§Ù„Ù…Ù†ØªØ¬ Ø§Ù„Ø£ÙƒØ«Ø± Ø·Ù„Ø¨Ø§Ù‹</h3>
        <p>{{ top_product|default:"--" }}</p>
      </div>
      <div class="kpi-card">
        <h3>Ù…ÙˆØ±Ø¯ Ù…ØªØ£Ø®Ø± Ø§Ù„ÙŠÙˆÙ…</h3>
        <p>{{ delayed_supplier|default:"--" }}</p>
      </div>
    </div>

    <!-- Ø±Ø³Ù… Ø¨ÙŠØ§Ù†ÙŠ Ø¯ÙŠÙ†Ø§Ù…ÙŠÙƒÙŠ -->
    <div class="chart-container">
      <canvas id="copilotChart"></canvas>
    </div>

    <!-- ÙˆØ­Ø¯Ø© ØªÙØ§Ø¹Ù„ÙŠØ© -->
    <div class="query-form">
      <input type="text" name="query" placeholder="Ø§Ø³Ø£Ù„ Copilot Ø¹Ù† Ø£ÙŠ ØªÙ‚Ø±ÙŠØ±...">
      <button onclick="askCopilot()">ØªØ­Ù„ÙŠÙ„</button>
    </div>

    <div id="response" class="response-box"></div>

  </div>

  <script>
    const ctx = document.getElementById('copilotChart').getContext('2d');
    new Chart(ctx, {
      type: 'line',
      data: {
        labels: ['Ø§Ù„Ø³Ø¨Øª', 'Ø§Ù„Ø£Ø­Ø¯', 'Ø§Ù„Ø¥Ø«Ù†ÙŠÙ†', 'Ø§Ù„Ø«Ù„Ø§Ø«Ø§Ø¡', 'Ø§Ù„Ø£Ø±Ø¨Ø¹Ø§Ø¡', 'Ø§Ù„Ø®Ù…ÙŠØ³', 'Ø§Ù„Ø¬Ù…Ø¹Ø©'],
        datasets: [{
          label: 'Ù…Ø¨ÙŠØ¹Ø§Øª Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹',
          data: [12000, 19000, 3000, 5000, 2000, 30000, 45000],
          borderColor: '#007bff',
          tension: 0.3
        }]
      },
      options: {
        plugins: {
          title: {
            display: true,
            text: 'ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ÙŠ'
          }
        }
      }
    });

    function askCopilot() {
      const query = document.querySelector('input[name="query"]').value;
      fetch(`/copilot/copilot/query/?query=` + encodeURIComponent(query))
        .then(res => res.json())
        .then(data => {
          document.getElementById("response").innerText = data.reply;
        });
    }

    function toggleTheme() {
      const current = localStorage.getItem("copilot-theme") || "light";
      const next = current === "light" ? "dark" : "light";
      document.getElementById("theme-style").href = next === "light"
        ? "{% static 'css/copilot.css' %}"
        : "{% static 'css/copilot-dark.css' %}";
      localStorage.setItem("copilot-theme", next);
    }

    window.addEventListener("load", () => {
      const saved = localStorage.getItem("copilot-theme") || "light";
      document.getElementById("theme-style").href = saved === "dark"
        ? "{% static 'css/copilot-dark.css' %}"
        : "{% static 'css/copilot.css' %}";
    });
  </script>
</body>
</html>
