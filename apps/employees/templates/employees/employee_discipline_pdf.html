{% load i18n %}
{% get_current_language_bidi as LANGUAGE_BIDI %}
<!doctype html>
<html lang="ar" dir="{% if LANGUAGE_BIDI %}rtl{% else %}ltr{% endif %}">
<head>
  <meta charset="utf-8">
  <title>{% if LANGUAGE_BIDI %}تقرير الانضباط الوظيفي{% else %}Employee Discipline Report{% endif %}</title>
  <style>
    @page { size: A4; margin: 18mm 14mm; }
    body{ font-family: "DejaVu Sans", "Noto Sans Arabic", Arial, sans-serif; font-size: 12px; color:#111; }
    h1,h2,h3,h4,h5{ margin: 0 0 8px; }
    .muted{ color:#666; }
    .mb-2{ margin-bottom: 8px; } .mb-3{ margin-bottom: 12px; } .mb-4{ margin-bottom: 16px; }
    .row{ display:flex; gap: 8px; }
    .col{ flex:1; }
    .badge{ display:inline-block; padding:2px 8px; border-radius:10px; font-size:10px; }
    .bg-success{ background:#22c55e; color:#fff; } .bg-danger{ background:#ef4444; color:#fff; } .bg-light{ background:#f5f5f5; }
    .card{ border:1px solid #ddd; border-radius:8px; padding:10px; }
    table{ width:100%; border-collapse:collapse; table-layout:fixed; }
    th,td{ border:1px solid #ccc; padding:6px; text-align:center; }
    thead th{ background:#f0f3f7; font-weight:700; }
    .small{ font-size: 11px; }
  </style>
</head>
<body>

  <!-- Header -->
  <h2 class="mb-2">{% if LANGUAGE_BIDI %}تقرير الانضباط الوظيفي{% else %}Employee Discipline Report{% endif %}</h2>
  <div class="row mb-3">
    <div class="col card">
      <strong>{% if LANGUAGE_BIDI %}الموظف{% else %}Employee{% endif %}:</strong>
      {{ employee.name|default:employee.full_name|default:employee.display_name|default:employee.username|default:("#"|add:employee.id) }}
    </div>
    <div class="col card">
      <strong>{% if LANGUAGE_BIDI %}القسم{% else %}Department{% endif %}:</strong>
      {{ employee.department|default:"-" }}
    </div>
    <div class="col card">
      <strong>{% if LANGUAGE_BIDI %}المسمى الوظيفي{% else %}Job Title{% endif %}:</strong>
      {{ employee.job_title|default:"-" }}
    </div>
    <div class="col card">
      <strong>{% if LANGUAGE_BIDI %}التاريخ{% else %}Date{% endif %}:</strong>
      {{ now|default:None|date:"Y-m-d" }}
    </div>
  </div>

  <!-- Work regulations status -->
  <div class="card mb-3">
    <h5 class="mb-2">📄 {% if LANGUAGE_BIDI %}حالة لائحة العمل{% else %}Work Regulations{% endif %}</h5>
    {% if regulation_status %}
      <span class="badge bg-success">✅ {% if LANGUAGE_BIDI %}تم التوقيع{% else %}Signed{% endif %}</span>
    {% else %}
      <span class="badge bg-danger">⚠️ {% if LANGUAGE_BIDI %}غير مُعتمدة{% else %}Not Approved{% endif %}</span>
    {% endif %}
  </div>

  <!-- Incentives -->
  <div class="card mb-4">
    <h5 class="mb-2">💰 {% if LANGUAGE_BIDI %}الحوافز والخصومات (الشهر الحالي){% else %}Incentives & Deductions (This Month){% endif %}</h5>
    <table>
      <thead>
        <tr>
          <th>🎯 {% if LANGUAGE_BIDI %}مكافأة الالتزام{% else %}Commitment Bonus{% endif %}</th>
          <th>🏅 {% if LANGUAGE_BIDI %}مكافأة ربع سنوية{% else %}Quarterly Bonus{% endif %}</th>
          <th>❌ {% if LANGUAGE_BIDI %}إجمالي الخصومات{% else %}Total Penalties{% endif %}</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td>{{ incentive.commitment_bonus|default:"0" }}</td>
          <td>{{ incentive.quarterly_bonus|default:"0" }}</td>
          <td>{{ incentive.penalty_total|default:"0" }}</td>
        </tr>
      </tbody>
    </table>
  </div>

  <!-- Discipline Records -->
  <h5 class="mb-2">⚖️ {% if LANGUAGE_BIDI %}سجل المخالفات{% else %}Discipline Records{% endif %}</h5>
  <table class="mb-4">
    <thead>
      <tr>
        <th>{% if LANGUAGE_BIDI %}النوع{% else %}Type{% endif %}</th>
        <th>{% if LANGUAGE_BIDI %}القيمة{% else %}Value{% endif %}</th>
        <th>{% if LANGUAGE_BIDI %}السبب{% else %}Reason{% endif %}</th>
        <th>{% if LANGUAGE_BIDI %}أنشئ بواسطة{% else %}Created By{% endif %}</th>
        <th>{% if LANGUAGE_BIDI %}التاريخ{% else %}Date{% endif %}</th>
      </tr>
    </thead>
    <tbody>
      {% for r in records %}
        <tr>
          <td>{{ r.type|default:"-" }}</td>
          <td>{{ r.value|default:"-" }}</td>
          <td>{{ r.reason|default:"-" }}</td>
          <td>{{ r.created_by|default:"-" }}</td>
          <td>
            {% if r.date %}{{ r.date|date:"Y-m-d" }}
            {% elif r.created_at %}{{ r.created_at|date:"Y-m-d" }}
            {% elif r.timestamp %}{{ r.timestamp|date:"Y-m-d" }}
            {% else %}-{% endif %}
          </td>
        </tr>
      {% empty %}
        <tr><td colspan="5" class="muted small">{% if LANGUAGE_BIDI %}لا توجد سجلات{% else %}No records{% endif %}</td></tr>
      {% endfor %}
    </tbody>
  </table>

  <!-- Production Logs -->
  <h5 class="mb-2">🧵 {% if LANGUAGE_BIDI %}سجل الإنتاج{% else %}Production Logs{% endif %}</h5>
  <table>
    <thead>
      <tr>
        <th>{% if LANGUAGE_BIDI %}التاريخ{% else %}Date{% endif %}</th>
        <th>{% if LANGUAGE_BIDI %}الكمية{% else %}Qty{% endif %}</th>
        <th>{% if LANGUAGE_BIDI %}أجر الوحدة{% else %}Unit Wage{% endif %}</th>
        <th>{% if LANGUAGE_BIDI %}الإجمالي{% else %}Total{% endif %}</th>
      </tr>
    </thead>
    <tbody>
      {% for p in production_logs %}
        <tr>
          <td>
            {% if p.date %}{{ p.date|date:"Y-m-d" }}
            {% elif p.created_at %}{{ p.created_at|date:"Y-m-d" }}
            {% elif p.timestamp %}{{ p.timestamp|date:"Y-m-d" }}
            {% else %}-{% endif %}
          </td>
          <td>{{ p.quantity|default:p.qty|default:"-" }}</td>
          <td>{{ p.unit_wage|default:p.wage|default:p.unit_price|default:p.rate|default:"-" }}</td>
          <td>{{ p.total|default:"0" }}</td>
        </tr>
      {% empty %}
        <tr><td colspan="4" class="muted small">{% if LANGUAGE_BIDI %}لا توجد سجلات{% else %}No records{% endif %}</td></tr>
      {% endfor %}
    </tbody>
  </table>

</body>
</html>
