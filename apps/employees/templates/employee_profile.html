{% extends "core/base.html" %}
{% load i18n static %}

{% block title %}{{ employee.name|default:employee.full_name|default:"Ø§Ù„Ù…Ù„Ù Ø§Ù„Ø´Ø®ØµÙŠ" }}{% endblock %}

{% block content %}
<div class="container-fluid py-3" dir="{% if LANGUAGE_BIDI %}rtl{% else %}ltr{% endif %}">

  <!-- Header + actions -->
  <div class="d-flex align-items-center flex-wrap gap-2 mb-3">
    <h2 class="m-0 fw-bold">
      ğŸ‘¤ {{ employee.name|default:employee.full_name|default:employee.display_name|default:employee.username|default:("#"|add:employee.id) }}
    </h2>
    <div class="ms-auto d-flex gap-2">
      <a href="{% url 'employees:employee_list' %}" class="btn btn-light btn-sm">
        ğŸ”™ {% if LANGUAGE_BIDI %}Ø±Ø¬ÙˆØ¹{% else %}Back{% endif %}
      </a>
      <a href="{% url 'employees:employee_edit' employee.pk %}" class="btn btn-warning btn-sm text-dark">
        âœï¸ {% if LANGUAGE_BIDI %}ØªØ¹Ø¯ÙŠÙ„{% else %}Edit{% endif %}
      </a>
      <a href="?export=1" class="btn btn-outline-success btn-sm">ğŸ“Š Excel</a>
      <a href="?download_pdf=1" class="btn btn-outline-danger btn-sm">ğŸ–¨ï¸ PDF</a>
    </div>
  </div>

  <!-- Quick info badges -->
  <div class="row g-2 mb-3">
    <div class="col-6 col-md-3">
      <div class="card shadow-sm">
        <div class="card-body d-flex justify-content-between">
          <span>{% if LANGUAGE_BIDI %}Ø§Ù„Ù‚Ø³Ù…{% else %}Department{% endif %}</span>
          <strong>{{ employee.department|default:"-" }}</strong>
        </div>
      </div>
    </div>
    <div class="col-6 col-md-3">
      <div class="card shadow-sm">
        <div class="card-body d-flex justify-content-between">
          <span>{% if LANGUAGE_BIDI %}Ø§Ù„Ù…Ø³Ù…Ù‰{% else %}Title{% endif %}</span>
          <strong>{{ employee.job_title|default:"-" }}</strong>
        </div>
      </div>
    </div>
    <div class="col-6 col-md-3">
      <div class="card shadow-sm">
        <div class="card-body d-flex justify-content-between">
          <span>â­ {% if LANGUAGE_BIDI %}Ø§Ù„ØªÙ‚ÙŠÙŠÙ…{% else %}Score{% endif %}</span>
          <strong>{{ employee.evaluation_score|default:"-" }}</strong>
        </div>
      </div>
    </div>
    <div class="col-6 col-md-3">
      <div class="card shadow-sm">
        <div class="card-body d-flex justify-content-between">
          <span>ğŸŸ¢ {% if LANGUAGE_BIDI %}Ø§Ù„Ø­Ø§Ù„Ø©{% else %}Status{% endif %}</span>
          <strong>{% if employee.active %}{% if LANGUAGE_BIDI %}Ù†Ø´Ø·{% else %}Active{% endif %}{% else %}{% if LANGUAGE_BIDI %}ØºÙŠØ± Ù†Ø´Ø·{% else %}Inactive{% endif %}{% endif %}</strong>
        </div>
      </div>
    </div>
  </div>

  <!-- Work Regulations -->
  <div class="card shadow-sm mb-3">
    <div class="card-body">
      <h5 class="mb-2">ğŸ“„ {% if LANGUAGE_BIDI %}Ø­Ø§Ù„Ø© Ù„Ø§Ø¦Ø­Ø© Ø§Ù„Ø¹Ù…Ù„{% else %}Work Regulations{% endif %}</h5>
      {% if regulation_status %}
        <span class="text-success">âœ… {% if LANGUAGE_BIDI %}ØªÙ… Ø§Ù„ØªÙˆÙ‚ÙŠØ¹{% else %}Signed{% endif %}</span>
      {% else %}
        <span class="text-danger">âš ï¸ {% if LANGUAGE_BIDI %}Ù„Ù… ØªØªÙ… Ø§Ù„Ù…ÙˆØ§ÙÙ‚Ø© Ø¨Ø¹Ø¯{% else %}Pending approval{% endif %}</span>
      {% endif %}
      <a href="{% url 'work_regulations:view_work_regulation' %}" class="btn btn-outline-primary btn-sm ms-2">
        ğŸ”— {% if LANGUAGE_BIDI %}Ø¹Ø±Ø¶ Ø§Ù„Ù„Ø§Ø¦Ø­Ø©{% else %}Open Regulation{% endif %}
      </a>
    </div>
  </div>

  <!-- Incentives & deductions -->
  <div class="card shadow-sm mb-3">
    <div class="card-body">
      <h5 class="mb-3">ğŸ’° {% if LANGUAGE_BIDI %}Ø§Ù„Ø­ÙˆØ§ÙØ² ÙˆØ§Ù„Ø®ØµÙˆÙ…Ø§Øª Ù„Ù‡Ø°Ø§ Ø§Ù„Ø´Ù‡Ø±{% else %}This Month Incentives & Deductions{% endif %}</h5>
      <ul class="list-group">
        <li class="list-group-item d-flex justify-content-between">
          ğŸ¯ {% if LANGUAGE_BIDI %}Ù…ÙƒØ§ÙØ£Ø© Ø§Ù„Ø§Ù„ØªØ²Ø§Ù…{% else %}Commitment Bonus{% endif %}
          <span class="badge bg-success">{{ incentive.commitment_bonus|default:"0" }}</span>
        </li>
        <li class="list-group-item d-flex justify-content-between">
          ğŸ… {% if LANGUAGE_BIDI %}Ù…ÙƒØ§ÙØ£Ø© Ø±Ø¨Ø¹ Ø³Ù†ÙˆÙŠØ©{% else %}Quarterly Bonus{% endif %}
          <span class="badge bg-success">{{ incentive.quarterly_bonus|default:"0" }}</span>
        </li>
        <li class="list-group-item d-flex justify-content-between">
          âŒ {% if LANGUAGE_BIDI %}Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø®ØµÙˆÙ…Ø§Øª{% else %}Total Penalties{% endif %}
          <span class="badge bg-danger">{{ incentive.penalty_total|default:"0" }}</span>
        </li>
      </ul>
    </div>
  </div>

  <!-- Filters for discipline records -->
  <div class="card shadow-sm mb-3">
    <div class="card-body">
      <form class="row g-2" method="get">
        <div class="col-12 col-md-3">
          <label class="form-label">{% if LANGUAGE_BIDI %}Ù†ÙˆØ¹ Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡{% else %}Action Type{% endif %}</label>
          <input type="text" name="action_type" value="{{ request.GET.action_type }}" class="form-control form-control-sm" placeholder="{% if LANGUAGE_BIDI %}Ù…Ø«Ù„: Ø®ØµÙ…{% else %}e.g. penalty{% endif %}">
        </div>
        <div class="col-6 col-md-3">
          <label class="form-label">{% if LANGUAGE_BIDI %}Ù…Ù† ØªØ§Ø±ÙŠØ®{% else %}From{% endif %}</label>
          <input type="date" name="date_from" value="{{ request.GET.date_from }}" class="form-control form-control-sm">
        </div>
        <div class="col-6 col-md-3">
          <label class="form-label">{% if LANGUAGE_BIDI %}Ø¥Ù„Ù‰ ØªØ§Ø±ÙŠØ®{% else %}To{% endif %}</label>
          <input type="date" name="date_to" value="{{ request.GET.date_to }}" class="form-control form-control-sm">
        </div>
        <div class="col-12 col-md-3 d-flex align-items-end">
          <button class="btn btn-outline-secondary btn-sm w-100" type="submit">
            ğŸ” {% if LANGUAGE_BIDI %}ØªØµÙÙŠØ©{% else %}Filter{% endif %}
          </button>
        </div>
      </form>
    </div>
  </div>

  <!-- Discipline records table -->
  <div class="card shadow-sm mb-3">
    <div class="card-body">
      <h5 class="mb-3">âš–ï¸ {% if LANGUAGE_BIDI %}Ø³Ø¬Ù„ Ø§Ù„Ù…Ø®Ø§Ù„ÙØ§Øª{% else %}Discipline Records{% endif %}</h5>
      <div class="table-responsive">
        <table class="table table-sm table-bordered align-middle">
          <thead class="table-light">
            <tr>
              <th>{% if LANGUAGE_BIDI %}Ø§Ù„Ù†ÙˆØ¹{% else %}Type{% endif %}</th>
              <th>{% if LANGUAGE_BIDI %}Ø§Ù„Ù‚ÙŠÙ…Ø©{% else %}Value{% endif %}</th>
              <th>{% if LANGUAGE_BIDI %}Ø§Ù„Ø³Ø¨Ø¨{% else %}Reason{% endif %}</th>
              <th>{% if LANGUAGE_BIDI %}Ø£Ù†Ø´Ø¦ Ø¨ÙˆØ§Ø³Ø·Ø©{% else %}Created By{% endif %}</th>
              <th>{% if LANGUAGE_BIDI %}Ø§Ù„ØªØ§Ø±ÙŠØ®{% else %}Date{% endif %}</th>
            </tr>
          </thead>
          <tbody>
            {% for r in records %}
              <tr>
                <td>{{ r.type|default:"-" }}</td>
                <td>{{ r.value|default:"-" }}</td>
                <td>{{ r.reason|default:"-" }}</td>
                <td>{{ r.created_by|default:"-" }}</td>
                <td>
                  {{ r.date|date:"Y-m-d"|default:r.created_at|date:"Y-m-d"|default:r.timestamp|date:"Y-m-d"|default:"-" }}
                </td>
              </tr>
            {% empty %}
              <tr><td colspan="5" class="text-center text-muted">{% if LANGUAGE_BIDI %}Ù„Ø§ ØªÙˆØ¬Ø¯ Ø³Ø¬Ù„Ø§Øª{% else %}No records{% endif %}</td></tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
    </div>
  </div>

  <!-- Production logs -->
  <div class="card shadow-sm mb-3">
    <div class="card-body">
      <h5 class="mb-3">ğŸ§µ {% if LANGUAGE_BIDI %}Ø¥Ù†ØªØ§Ø¬ Ø§Ù„Ù…ÙˆØ¸Ù{% else %}Production Logs{% endif %}</h5>
      <div class="table-responsive">
        <table class="table table-sm table-bordered align-middle">
          <thead class="table-light">
            <tr>
              <th>{% if LANGUAGE_BIDI %}Ø§Ù„ØªØ§Ø±ÙŠØ®{% else %}Date{% endif %}</th>
              <th>{% if LANGUAGE_BIDI %}Ø§Ù„ÙƒÙ…ÙŠØ©{% else %}Qty{% endif %}</th>
              <th>{% if LANGUAGE_BIDI %}Ø£Ø¬Ø± Ø§Ù„ÙˆØ­Ø¯Ø©{% else %}Unit Wage{% endif %}</th>
              <th>{% if LANGUAGE_BIDI %}Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ{% else %}Total{% endif %}</th>
            </tr>
          </thead>
          <tbody>
            {% for p in production_logs %}
              <tr>
                <td>{{ p.date|date:"Y-m-d"|default:p.created_at|date:"Y-m-d"|default:p.timestamp|date:"Y-m-d"|default:"-" }}</td>
                <td>{{ p.quantity|default:p.qty|default:"-" }}</td>
                <td>{{ p.unit_wage|default:p.wage|default:p.unit_price|default:p.rate|default:"-" }}</td>
                <td>{{ p.total|default:"0" }}</td>
              </tr>
            {% empty %}
              <tr><td colspan="4" class="text-center text-muted">{% if LANGUAGE_BIDI %}Ù„Ø§ ØªÙˆØ¬Ø¯ Ø³Ø¬Ù„Ø§Øª{% else %}No records{% endif %}</td></tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
    </div>
  </div>

</div>
{% endblock %}
