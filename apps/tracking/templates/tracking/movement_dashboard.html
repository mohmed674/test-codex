{% extends "base.html" %}
{% load static %}

{% block content %}
<div class="container mt-4">
  <div class="card shadow p-4 rounded-4">

    <div class="d-flex justify-content-between align-items-center mb-3">
      <h4 class="mb-0">🚚 لوحة تحركات الشحنات</h4>
      <a href="{% url 'tracking:movement_create' %}" class="btn btn-success">➕ تسجيل حركة جديدة</a>
    </div>

    <!-- 🔍 فلترة -->
    <form method="get" class="row g-2 mb-4">
      <div class="col-md-4">
        <input type="text" name="tracking_code" class="form-control" placeholder="كود التتبع" value="{{ filters.tracking_code }}">
      </div>
      <div class="col-md-4">
        <select name="status" class="form-select">
          <option value="">كل الحالات</option>
          <option value="pending" {% if filters.status == 'pending' %}selected{% endif %}>قيد الشحن</option>
          <option value="in_transit" {% if filters.status == 'in_transit' %}selected{% endif %}>قيد النقل</option>
          <option value="delivered" {% if filters.status == 'delivered' %}selected{% endif %}>تم التسليم</option>
          <option value="cancelled" {% if filters.status == 'cancelled' %}selected{% endif %}>أُلغيت</option>
        </select>
      </div>
      <div class="col-md-2">
        <input type="date" name="from" class="form-control" value="{{ filters.from }}">
      </div>
      <div class="col-md-2">
        <input type="date" name="to" class="form-control" value="{{ filters.to }}">
      </div>
      <div class="col-md-3 mt-2">
        <button type="submit" class="btn btn-dark w-100">🔍 بحث</button>
      </div>
      <div class="col-md-3 mt-2">
        <a href="{% url 'tracking:tracking_movement_dashboard' %}" class="btn btn-secondary w-100">🔁 إعادة تعيين</a>
      </div>
    </form>

    <!-- 📋 جدول -->
    <div class="table-responsive">
      <table class="table table-bordered table-striped text-center align-middle">
        <thead class="table-dark">
          <tr>
            <th>كود التتبع</th>
            <th>المنتج</th>
            <th>الموقع</th>
            <th>الحالة</th>
            <th>الوقت</th>
          </tr>
        </thead>
        <tbody>
          {% for move in movements %}
          <tr>
            <td>{{ move.tracking.tracking_code }}</td>
            <td>{{ move.tracking.product_name }}</td>
            <td>{{ move.location }}</td>
            <td>
              {% if move.status == 'pending' %}
                <span class="badge bg-warning text-dark">قيد الشحن</span>
              {% elif move.status == 'in_transit' %}
                <span class="badge bg-info text-dark">قيد النقل</span>
              {% elif move.status == 'delivered' %}
                <span class="badge bg-success">تم التسليم</span>
              {% elif move.status == 'cancelled' %}
                <span class="badge bg-danger">أُلغيت</span>
              {% else %}
                <span class="badge bg-secondary">{{ move.get_status_display }}</span>
              {% endif %}
            </td>
            <td>{{ move.timestamp|date:"Y-m-d H:i" }}</td>
          </tr>
          {% empty %}
          <tr>
            <td colspan="5" class="text-danger text-center">لا توجد تحركات مسجلة.</td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>

  </div>
</div>
{% endblock %}
