{% extends "core/base.html" %}
{% load i18n static %}

{% block title %}{% trans "Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª" %}{% endblock %}
{% block header_title %}ğŸ“¦ {% trans "Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠØ©" %}{% endblock %}
{% block breadcrumbs %}<a href="{% url 'core:launcher' %}">{% trans "Ø§Ù„ØªØ·Ø¨ÙŠÙ‚Ø§Øª" %}</a> / {% trans "Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª" %}{% endblock %}

{% block content %}
<div class="container-fluid px-3 pb-4">

  <!-- ÙÙ„Ø§ØªØ± ÙˆØ¨Ø­Ø« -->
  <form method="get" class="card mb-3">
    <div class="card-body row g-2 align-items-end">
      <div class="col-sm-4 col-md-4">
        <label class="form-label">{% trans "Ø¨Ø­Ø«" %}</label>
        <input type="search" name="q" value="{{ filters.q }}" class="form-control" placeholder="{% trans 'Ø§Ø¨Ø­Ø« Ø¨Ø§Ù„Ø§Ø³Ù… Ø£Ùˆ ÙƒÙˆØ¯ Ø§Ù„Ù…Ù†ØªØ¬â€¦' %}" data-slash-focus>
      </div>
      <div class="col-sm-3 col-md-2">
        <label class="form-label">{% trans "Ù…Ù† ØªØ§Ø±ÙŠØ® Ø¥Ù†ØªØ§Ø¬" %}</label>
        <input type="date" name="date_from" value="{{ filters.date_from }}" class="form-control">
      </div>
      <div class="col-sm-3 col-md-2">
        <label class="form-label">{% trans "Ø¥Ù„Ù‰ ØªØ§Ø±ÙŠØ® Ø¥Ù†ØªØ§Ø¬" %}</label>
        <input type="date" name="date_to" value="{{ filters.date_to }}" class="form-control">
      </div>
      <div class="col-sm-3 col-md-2">
        <label class="form-label">{% trans "ØªØ±ØªÙŠØ¨" %}</label>
        <select name="ordering" class="form-select">
          <option value="">{% trans "Ø§ÙØªØ±Ø§Ø¶ÙŠ" %}</option>
          <option value="product_code" {% if filters.ordering == 'product_code' %}selected{% endif %}>{% trans "Ø§Ù„ÙƒÙˆØ¯ ØªØµØ§Ø¹Ø¯ÙŠ" %}</option>
          <option value="-product_code" {% if filters.ordering == '-product_code' %}selected{% endif %}>{% trans "Ø§Ù„ÙƒÙˆØ¯ ØªÙ†Ø§Ø²Ù„ÙŠ" %}</option>
          <option value="name" {% if filters.ordering == 'name' %}selected{% endif %}>{% trans "Ø§Ù„Ø§Ø³Ù… ØªØµØ§Ø¹Ø¯ÙŠ" %}</option>
          <option value="-name" {% if filters.ordering == '-name' %}selected{% endif %}>{% trans "Ø§Ù„Ø§Ø³Ù… ØªÙ†Ø§Ø²Ù„ÙŠ" %}</option>
          <option value="date_produced" {% if filters.ordering == 'date_produced' %}selected{% endif %}>{% trans "ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¥Ù†ØªØ§Ø¬ ØªØµØ§Ø¹Ø¯ÙŠ" %}</option>
          <option value="-date_produced" {% if filters.ordering == '-date_produced' %}selected{% endif %}>{% trans "ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¥Ù†ØªØ§Ø¬ ØªÙ†Ø§Ø²Ù„ÙŠ" %}</option>
          <option value="expiry_date" {% if filters.ordering == 'expiry_date' %}selected{% endif %}>{% trans "ØªØ§Ø±ÙŠØ® Ø§Ù„Ø§Ù†ØªÙ‡Ø§Ø¡ ØªØµØ§Ø¹Ø¯ÙŠ" %}</option>
          <option value="-expiry_date" {% if filters.ordering == '-expiry_date' %}selected{% endif %}>{% trans "ØªØ§Ø±ÙŠØ® Ø§Ù„Ø§Ù†ØªÙ‡Ø§Ø¡ ØªÙ†Ø§Ø²Ù„ÙŠ" %}</option>
        </select>
      </div>
      <div class="col-sm-12 col-md-2 d-flex gap-2">
        <button class="btn btn-primary flex-grow-1" type="submit"><i class="fa-solid fa-magnifying-glass me-1"></i> {% trans "ØªØ·Ø¨ÙŠÙ‚" %}</button>
        <a class="btn btn-light" href="?"><i class="fa-solid fa-rotate-left me-1"></i> {% trans "ØªÙØ±ÙŠØº" %}</a>
      </div>
    </div>
  </form>

  <!-- Ø´Ø±ÙŠØ· Ø£Ø¯ÙˆØ§Øª -->
  <div class="d-flex flex-wrap gap-2 mb-3">
    <a href="{% url 'products:product_create' %}" class="btn btn-success">
      <i class="fa-solid fa-plus"></i> {% trans "Ø¥Ø¶Ø§ÙØ© Ù…Ù†ØªØ¬" %}
    </a>

    {% with qs=request.GET.urlencode %}
      <a class="btn btn-outline-secondary" href="?{% if qs %}{{ qs }}&{% endif %}download_pdf=1">
        <i class="fa-solid fa-file-pdf"></i> PDF
      </a>
      <a class="btn btn-outline-secondary" href="?{% if qs %}{{ qs }}&{% endif %}export=excel">
        <i class="fa-solid fa-file-excel"></i> Excel
      </a>
      <a class="btn btn-outline-secondary" href="?{% if qs %}{{ qs }}&{% endif %}export=csv">
        <i class="fa-solid fa-file-csv"></i> CSV
      </a>
      <a class="btn btn-outline-secondary" href="?{% if qs %}{{ qs }}&{% endif %}export=json" target="_blank" rel="noopener">
        <i class="fa-solid fa-code"></i> JSON
      </a>
    {% endwith %}
  </div>

  <!-- Ø§Ù„Ø¬Ø¯ÙˆÙ„ -->
  <div class="table-responsive">
    <table class="table table-hover align-middle">
      <thead class="table-light">
        <tr>
          <th>{% trans "Ø§Ù„ÙƒÙˆØ¯" %}</th>
          <th>{% trans "Ø§Ù„Ø§Ø³Ù…" %}</th>
          <th class="text-center">{% trans "Ø§Ù„ÙƒÙ…ÙŠØ©" %}</th>
          <th>{% trans "Ø§Ù„Ø­Ø§Ù„Ø©" %}</th>
          <th>{% trans "ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¥Ù†ØªØ§Ø¬" %}</th>
          <th>{% trans "ØªØ§Ø±ÙŠØ® Ø§Ù„Ø§Ù†ØªÙ‡Ø§Ø¡" %}</th>
          <th>{% trans "Ø¨Ø§Ø±ÙƒÙˆØ¯/QR" %}</th>
          <th class="text-center">{% trans "Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª" %}</th>
        </tr>
      </thead>
      <tbody>
      {% for product in products %}
        <tr>
          <td class="fw-semibold">{{ product.product_code }}</td>
          <td>{{ product.name }}</td>
          <td class="text-center">{{ product.quantity }}</td>
          <td>
            {% with s=product.get_quality_status_display|default:product.get_status_display %}
            {% with key=product.quality_status|default:product.status %}
              <span class="badge
                {% if key == 'good' %} bg-success
                {% elif key == 'average' %} bg-warning text-dark
                {% elif key == 'rejected' %} bg-danger
                {% else %}
                  {% if 'Ø¬ÙŠØ¯' in s or 'Good' in s or 'ØµØ§Ù„Ø­' in s %} bg-success
                  {% elif 'Ù…Ù‚Ø¨ÙˆÙ„' in s or 'Accept' in s or 'Ù…ØªÙˆØ³Ø·' in s %} bg-warning text-dark
                  {% elif 'Ù…Ø±ÙÙˆØ¶' in s or 'Rejected' in s or 'Ø³ÙŠØ¡' in s %} bg-danger
                  {% else %} bg-secondary {% endif %}
                {% endif %}">
                {{ s }}
              </span>
            {% endwith %}
            {% endwith %}
          </td>
          <td>{{ product.date_produced|date:"Y-m-d" }}</td>
          <td>
            {% with exp=product.expiration_date|default:product.expiry_date %}
              {% if exp %}{{ exp|date:"Y-m-d" }}{% else %}-{% endif %}
            {% endwith %}
          </td>
          <td>
            {% if product.qr_code %}
              <img src="{{ product.qr_code.url }}" alt="QR" width="44" height="44" class="rounded border">
            {% else %}
              <span class="text-muted">â€”</span>
            {% endif %}
          </td>
          <td class="text-center">
            <div class="btn-group btn-group-sm">
              <a href="{% url 'products:product_edit' product.id %}" class="btn btn-outline-primary">
                <i class="fa-solid fa-pen-to-square"></i>
              </a>
              <a href="{% url 'products:product_delete' product.id %}" class="btn btn-outline-danger" data-confirm="{% trans 'Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø§Ù„Ø­Ø°ÙØŸ' %}">
                <i class="fa-solid fa-trash-can"></i>
              </a>
            </div>
          </td>
        </tr>
      {% empty %}
        <tr>
          <td colspan="8" class="text-center text-muted py-4">{% trans "Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ù†ØªØ¬Ø§Øª." %}</td>
        </tr>
      {% endfor %}
      </tbody>
    </table>
  </div>

  <!-- ØªØ±Ù‚ÙŠÙ… Ø§Ù„ØµÙØ­Ø§Øª -->
  {% if page_obj.has_other_pages %}
  {% with qs=request.GET.urlencode %}
  <nav aria-label="pages">
    <ul class="pagination justify-content-center">
      <li class="page-item {% if not page_obj.has_previous %}disabled{% endif %}">
        <a class="page-link" href="?page={{ page_obj.previous_page_number }}{% if qs %}&{{ qs }}{% endif %}" aria-label="{% trans 'Ø§Ù„Ø³Ø§Ø¨Ù‚' %}">
          <span aria-hidden="true">&laquo;</span>
        </a>
      </li>
      {% for num in page_obj.paginator.page_range %}
        <li class="page-item {% if num == page_obj.number %}active{% endif %}">
          <a class="page-link" href="?page={{ num }}{% if qs %}&{{ qs }}{% endif %}">{{ num }}</a>
        </li>
      {% endfor %}
      <li class="page-item {% if not page_obj.has_next %}disabled{% endif %}">
        <a class="page-link" href="?page={{ page_obj.next_page_number }}{% if qs %}&{{ qs }}{% endif %}" aria-label="{% trans 'Ø§Ù„ØªØ§Ù„ÙŠ' %}">
          <span aria-hidden="true">&raquo;</span>
        </a>
      </li>
    </ul>
  </nav>
  {% endwith %}
  {% endif %}

</div>
{% endblock %}

