{% extends "core/base.html" %}
{% load i18n static %}

{% block title %}{% trans "Ø­Ø°Ù Ù…Ù†ØªØ¬" %}{% endblock %}
{% block header_title %}ğŸ—‘ï¸ {% trans "ØªØ£ÙƒÙŠØ¯ Ø­Ø°Ù Ø§Ù„Ù…Ù†ØªØ¬" %}{% endblock %}
{% block breadcrumbs %}
  <a href="{% url 'core:launcher' %}">{% trans "Ø§Ù„ØªØ·Ø¨ÙŠÙ‚Ø§Øª" %}</a> /
  <a href="{% url 'products:product_list' %}">{% trans "Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª" %}</a> /
  {% trans "Ø­Ø°Ù" %}
{% endblock %}

{% block content %}
<div class="container-fluid px-3 pb-4">
  <div class="alert alert-danger d-flex align-items-center" role="alert">
    <i class="fa-solid fa-triangle-exclamation me-2"></i>
    <div>
      <strong>{% trans "ØªØ­Ø°ÙŠØ±:" %}</strong>
      {% trans "Ø³ÙŠØªÙ… Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„Ù…Ù†ØªØ¬ Ù†Ù‡Ø§Ø¦ÙŠÙ‹Ø§ ÙˆÙ„Ø§ ÙŠÙ…ÙƒÙ† Ø§Ù„ØªØ±Ø§Ø¬Ø¹ Ø¹Ù† Ø§Ù„Ø¹Ù…Ù„ÙŠØ©." %}
    </div>
  </div>

  <div class="card mb-3">
    <div class="card-body">
      <div class="row g-3 align-items-start">
        <div class="col-auto">
          <div class="border rounded-3 p-2 bg-white">
            {% if product.image %}
              <img src="{{ product.image.url }}" alt="" style="width:96px;height:96px;object-fit:contain">
            {% else %}
              <img src="{% static 'icons/icon-192x192.png' %}" alt="" style="width:96px;height:96px;object-fit:contain;opacity:.75">
            {% endif %}
          </div>
        </div>
        <div class="col">
          <h2 class="h5 mb-1">{{ product.name }}</h2>
          <div class="text-muted small">
            <span class="me-3"><i class="fa-solid fa-barcode"></i> {{ product.product_code }}</span>
            <span class="me-3"><i class="fa-solid fa-boxes-stacked"></i> {{ product.quantity }}</span>
            {% if product.quality_status %}
              <span class="badge
                {% if product.quality_status == 'good' %} bg-success
                {% elif product.quality_status == 'average' %} bg-warning text-dark
                {% elif product.quality_status == 'rejected' %} bg-danger
                {% else %} bg-secondary {% endif %}">
                {{ product.get_quality_status_display|default:product.quality_status }}
              </span>
            {% endif %}
          </div>

          <div class="row mt-3 g-2">
            <div class="col-6 col-md-3">
              <div class="small text-muted">{% trans "ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¥Ù†ØªØ§Ø¬" %}</div>
              <div class="fw-semibold">{{ product.date_produced|date:"Y-m-d" }}</div>
            </div>
            <div class="col-6 col-md-3">
              <div class="small text-muted">{% trans "ØªØ§Ø±ÙŠØ® Ø§Ù„Ø§Ù†ØªÙ‡Ø§Ø¡" %}</div>
              <div class="fw-semibold">
                {% with exp=product.expiration_date|default:product.expiry_date %}
                  {% if exp %}{{ exp|date:"Y-m-d" }}{% else %}-{% endif %}
                {% endwith %}
              </div>
            </div>
            <div class="col-6 col-md-3">
              <div class="small text-muted">{% trans "Ø£ÙÙ†Ø´Ø¦ ÙÙŠ" %}</div>
              <div class="fw-semibold">{{ product.created_at|default:"â€”" }}</div>
            </div>
            <div class="col-6 col-md-3">
              <div class="small text-muted">{% trans "Ø¢Ø®Ø± ØªØ­Ø¯ÙŠØ«" %}</div>
              <div class="fw-semibold">{{ product.updated_at|default:"â€”" }}</div>
            </div>
          </div>
        </div>

        <div class="col-auto">
          <div class="border rounded-3 p-2 bg-white">
            {% if product.qr_code %}
              <img src="{{ product.qr_code.url }}" alt="QR" style="width:96px;height:96px;object-fit:contain">
            {% else %}
              <div class="d-flex align-items-center justify-content-center" style="width:96px;height:96px;opacity:.5">
                <i class="fa-solid fa-qrcode fa-2x"></i>
              </div>
            {% endif %}
          </div>
        </div>
      </div>
    </div>
  </div>

  <form method="post" class="d-flex flex-wrap gap-2">
    {% csrf_token %}
    <div class="form-check">
      <input class="form-check-input" type="checkbox" value="1" id="confirmChk" required>
      <label class="form-check-label" for="confirmChk">
        {% trans "Ø£Ù‚Ø±Ù‘ Ø¨Ø£Ù†Ù†ÙŠ Ø£ÙÙ‡Ù… Ø£Ù† Ø§Ù„Ø­Ø°Ù Ù†Ù‡Ø§Ø¦ÙŠ ÙˆÙ„Ø§ ÙŠÙ…ÙƒÙ† Ø§Ù„ØªØ±Ø§Ø¬Ø¹ Ø¹Ù†Ù‡." %}
      </label>
    </div>
    <div class="w-100"></div>
    <button type="submit" class="btn btn-danger">
      <i class="fa-solid fa-trash-can"></i> {% trans "Ø­Ø°Ù Ù†Ù‡Ø§Ø¦ÙŠ" %}
    </button>
    <a href="{% url 'products:product_list' %}" class="btn btn-secondary">
      <i class="fa-solid fa-arrow-rotate-left"></i> {% trans "Ø±Ø¬ÙˆØ¹" %}
    </a>
  </form>
</div>

<script>
  // ØªØ£ÙƒÙŠØ¯ Ø¨Ø³ÙŠØ· Ù‚Ø¨Ù„ Ø§Ù„Ø¥Ø±Ø³Ø§Ù„
  (function(){
    const form = document.currentScript && document.currentScript.previousElementSibling;
    if (!form || form.tagName !== 'FORM') return;
    form.addEventListener('submit', function(e){
      if (!confirm("{% filter escapejs %}{% trans 'Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø§Ù„Ø­Ø°Ù Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠØŸ' %}{% endfilter %}")){
        e.preventDefault();
      }
    });
  })();
</script>
{% endblock %}
